{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport fbApp from \"../utils/FireBaseInit\";\nvar SET_AUTH_STATUS = 'SET_AUTH_STATUS';\nvar SET_AUTH_SUCCESS = 'SET_AUTH_SUCCESS';\nvar SET_AUTH_LOGOUT = 'SET_AUTH_LOGOUT';\nexport var MODULE_NAME = 'auth';\nexport var selectAuthStatus = function selectAuthStatus(state) {\n  return state[MODULE_NAME].status;\n};\nexport var selectUser = function selectUser(state) {\n  return state[MODULE_NAME];\n};\nvar initialState = {\n  status: false,\n  userID: null,\n  name: null,\n  userName: null,\n  group: null\n};\nexport function reducer() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initialState;\n\n  var _ref = arguments.length > 1 ? arguments[1] : undefined,\n      type = _ref.type,\n      payload = _ref.payload;\n\n  switch (type) {\n    case SET_AUTH_STATUS:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        status: payload\n      });\n\n    case SET_AUTH_SUCCESS:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        status: true,\n        userID: payload.userID,\n        name: payload.name,\n        userName: payload.userName,\n        group: payload.group\n      });\n\n    case SET_AUTH_LOGOUT:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        status: false,\n        userID: null,\n        name: null,\n        userName: null,\n        group: null\n      });\n\n    default:\n      return state;\n  }\n}\nexport var setAuthStatus = function setAuthStatus(payload) {\n  return {\n    type: SET_AUTH_STATUS,\n    payload: payload\n  };\n};\nexport var setAuthSuccess = function setAuthSuccess(payload) {\n  return {\n    type: SET_AUTH_SUCCESS,\n    payload: payload\n  };\n};\nexport var setAuthLogOut = function setAuthLogOut() {\n  return {\n    type: SET_AUTH_LOGOUT\n  };\n};\nexport var logIn = function logIn(email, password) {\n  return function _callee(dispatch) {\n    var _await$fbApp$auth$sig, uid, reference;\n\n    return _regeneratorRuntime.async(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            _context.next = 3;\n            return _regeneratorRuntime.awrap(fbApp.auth.signInWithEmailAndPassword(email, password));\n\n          case 3:\n            _await$fbApp$auth$sig = _context.sent;\n            uid = _await$fbApp$auth$sig.user.uid;\n            _context.next = 7;\n            return _regeneratorRuntime.awrap(fbApp.db.ref(\"users/\" + uid));\n\n          case 7:\n            reference = _context.sent;\n            reference.on('value', function (snapshot) {\n              if (snapshot.exists()) {\n                var userObj = snapshot.val();\n                dispatch(setAuthSuccess(_objectSpread({\n                  userID: uid\n                }, userObj)));\n              }\n            });\n            _context.next = 14;\n            break;\n\n          case 11:\n            _context.prev = 11;\n            _context.t0 = _context[\"catch\"](0);\n            console.log('log in err', _context.t0);\n\n          case 14:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[0, 11]], Promise);\n  };\n};\nexport var signUp = function signUp(email, name, userName, password, group) {\n  return function _callee2(dispatch) {\n    var _await$fbApp$auth$cre, uid;\n\n    return _regeneratorRuntime.async(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.prev = 0;\n            _context2.next = 3;\n            return _regeneratorRuntime.awrap(fbApp.auth.createUserWithEmailAndPassword(email, password));\n\n          case 3:\n            _await$fbApp$auth$cre = _context2.sent;\n            uid = _await$fbApp$auth$cre.user.uid;\n            fbApp.db.ref(\"users/\" + uid).set({\n              userName: userName,\n              name: name,\n              group: group\n            });\n            dispatch(setAuthSuccess({\n              userID: uid,\n              name: name,\n              userName: userName,\n              password: password,\n              group: group\n            }));\n            _context2.next = 12;\n            break;\n\n          case 9:\n            _context2.prev = 9;\n            _context2.t0 = _context2[\"catch\"](0);\n            console.log('signUp err', _context2.t0);\n\n          case 12:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, [[0, 9]], Promise);\n  };\n};\nexport var logOut = function logOut() {\n  return function _callee3(dispatch) {\n    return _regeneratorRuntime.async(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.prev = 0;\n            _context3.next = 3;\n            return _regeneratorRuntime.awrap(fbApp.auth.signOut());\n\n          case 3:\n            dispatch(setAuthLogOut());\n            _context3.next = 9;\n            break;\n\n          case 6:\n            _context3.prev = 6;\n            _context3.t0 = _context3[\"catch\"](0);\n            console.log('log out err', _context3.t0);\n\n          case 9:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, [[0, 6]], Promise);\n  };\n};","map":{"version":3,"sources":["D:/projects/student-information-system/student-information-system/redux/auth.js"],"names":["fbApp","SET_AUTH_STATUS","SET_AUTH_SUCCESS","SET_AUTH_LOGOUT","MODULE_NAME","selectAuthStatus","state","status","selectUser","initialState","userID","name","userName","group","reducer","type","payload","setAuthStatus","setAuthSuccess","setAuthLogOut","logIn","email","password","dispatch","auth","signInWithEmailAndPassword","uid","user","db","ref","reference","on","snapshot","exists","userObj","val","console","log","signUp","createUserWithEmailAndPassword","set","logOut","signOut"],"mappings":"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","sourcesContent":["import fbApp from '../utils/FireBaseInit';\r\n//Action Types\r\nconst SET_AUTH_STATUS = 'SET_AUTH_STATUS';\r\nconst SET_AUTH_SUCCESS = 'SET_AUTH_SUCCESS';\r\nconst SET_AUTH_LOGOUT = 'SET_AUTH_LOGOUT';\r\n\r\n//Selectors\r\nexport const MODULE_NAME = 'auth';\r\nexport const selectAuthStatus = (state) => state[MODULE_NAME].status;\r\nexport const selectUser = (state) => state[MODULE_NAME];\r\n//Reducer\r\nconst initialState = {\r\n\tstatus: false,\r\n\tuserID: null, //use uppercase ID for ids\r\n\tname: null,\r\n\tuserName: null,\r\n\tgroup: null\r\n};\r\n\r\nexport function reducer(state = initialState, { type, payload }) {\r\n\tswitch (type) {\r\n\t\tcase SET_AUTH_STATUS:\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tstatus: payload\r\n\t\t\t};\r\n\t\tcase SET_AUTH_SUCCESS:\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tstatus: true,\r\n\t\t\t\tuserID: payload.userID,\r\n\t\t\t\tname: payload.name,\r\n\t\t\t\tuserName: payload.userName,\r\n\t\t\t\tgroup: payload.group\r\n\t\t\t};\r\n\t\tcase SET_AUTH_LOGOUT:\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tstatus: false,\r\n\t\t\t\tuserID: null,\r\n\t\t\t\tname: null,\r\n\t\t\t\tuserName: null,\r\n\t\t\t\tgroup: null\r\n\t\t\t};\r\n\t\tdefault:\r\n\t\t\treturn state;\r\n\t}\r\n}\r\n\r\n//ActionCreators\r\nexport const setAuthStatus = (payload) => ({\r\n\ttype: SET_AUTH_STATUS,\r\n\tpayload\r\n});\r\nexport const setAuthSuccess = (payload) => ({\r\n\ttype: SET_AUTH_SUCCESS,\r\n\tpayload\r\n});\r\nexport const setAuthLogOut = () => ({\r\n\ttype: SET_AUTH_LOGOUT\r\n});\r\n//Middlewares\r\n\r\nexport const logIn = (email, password) => async (dispatch) => {\r\n\ttry {\r\n\t\t//todo ask what else can u use for not using email\r\n\t\tconst { user: { uid } } = await fbApp.auth.signInWithEmailAndPassword(email, password);\r\n\t\t//full name of user\r\n\t\tconst reference = await fbApp.db.ref(`users/${uid}`);\r\n\t\treference.on('value', (snapshot) => {\r\n\t\t\tif (snapshot.exists()) {\r\n\t\t\t\tconst userObj = snapshot.val();\r\n\t\t\t\tdispatch(\r\n\t\t\t\t\tsetAuthSuccess({\r\n\t\t\t\t\t\tuserID: uid,\r\n\t\t\t\t\t\t...userObj\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t});\r\n\t} catch (err) {\r\n\t\tconsole.log('log in err', err);\r\n\t\t//todo handle error\r\n\t}\r\n};\r\nexport const signUp = (email, name, userName, password, group) => async (dispatch) => {\r\n\ttry {\r\n\t\t//todo ask what else can u use for not using email\r\n\t\tconst { user: { uid } } = await fbApp.auth.createUserWithEmailAndPassword(email, password);\r\n\t\tfbApp.db.ref(`users/${uid}`).set({\r\n\t\t\tuserName: userName,\r\n\t\t\tname: name,\r\n\t\t\tgroup: group\r\n\t\t});\r\n\r\n\t\tdispatch(\r\n\t\t\tsetAuthSuccess({\r\n\t\t\t\tuserID: uid,\r\n\t\t\t\tname,\r\n\t\t\t\tuserName,\r\n\t\t\t\tpassword,\r\n\t\t\t\tgroup\r\n\t\t\t})\r\n\t\t);\r\n\t} catch (err) {\r\n\t\tconsole.log('signUp err', err);\r\n\t\t//todo handle error\r\n\t}\r\n};\r\n\r\nexport const logOut = () => async (dispatch) => {\r\n\ttry {\r\n\t\tawait fbApp.auth.signOut();\r\n\t\tdispatch(setAuthLogOut());\r\n\t} catch (err) {\r\n\t\tconsole.log('log out err', err);\r\n\t}\r\n};\r\n"]},"metadata":{},"sourceType":"module"}